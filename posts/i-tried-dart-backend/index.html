<!doctype html><html lang=ja-jp dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>I tried Dart backend | yuzumone's blog</title>
<meta name=description content="
    
  "><meta name=keywords content="
    
  "><meta name=Hatena::Bookmark content="nocomment"><style>@import 'https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP:wght@400;600&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Noto+Color+Emoji&family=Secular+One&display=swap'</style><link rel=stylesheet href=/css/main.min.2421e6cca60bf0bd0ce22a86e5391b0a7b5bbd939bf4e3d651fd3384307eba3b.css integrity="sha256-JCHmzKYL8L0M4iqG5TkbCntbvZOb9OPWUf0zhDB+ujs=" crossorigin=anonymous><style>.bg{background-color:#f8f8f8}.chroma{background-color:#f8f8f8}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .cl{}.chroma .lnlinks{outline:none;text-decoration:none;color:inherit}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0}.chroma .hl{background-color:#dfdfdf}.chroma .lnt{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .line{display:flex}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:#ce5c00}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:#4e9a06}.chroma .sa{color:#4e9a06}.chroma .sb{color:#4e9a06}.chroma .sc{color:#4e9a06}.chroma .dl{color:#4e9a06}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:#4e9a06}.chroma .se{color:#4e9a06}.chroma .sh{color:#4e9a06}.chroma .si{color:#4e9a06}.chroma .sx{color:#4e9a06}.chroma .sr{color:#4e9a06}.chroma .s1{color:#4e9a06}.chroma .ss{color:#4e9a06}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:#ce5c00;font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:underline}</style><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js></script><script src=/js/search.942bd26f5f9a4a6909fc6fe8467bf5e63314ad56a308f6cf706af97ea3b80f27.js integrity="sha256-lCvSb1+aSmkJ/G/oRnv15jMUrVajCPbPcGr5fqO4Dyc=" crossorigin=anonymous></script></head><body><article class=posts><header><div class=header-container><div class=flex-none><h1 class=title><a href=https://blog.yuzumone.net/>yuzumone's blog</a></h1></div><nav><ul class=flex-items><li class=header-item><a href=/>Home</a></li><li class=header-item><a href=/archives/>Archives</a></li></ul></nav></div><div class=header-line></div></header><main><div><h1 class=article-title>I tried Dart backend</h1><div class=header-container><time datetime=2021-02-27T00:00:00+00:00>ğŸ—“ February 27, 2021</time><div class=article-tag><p class=flex-items>ğŸ·ï¸</p><ul class=flex-items><li class=header-item><a href=/tags/dart>Dart</a></li></ul></div></div></div><div><figure><img src="https://images.unsplash.com/photo-1606300015207-d4e499ffca80?w=800&amp;auto=format&amp;fit=crop&amp;q=60&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwcm9maWxlLXBhZ2V8N3x8fGVufDB8fHx8fA%3D%3D"><figcaption><h4>Photo by Goran Ivos on Unsplash</h4></figcaption></figure><p>Flutter ã«ã¯ç››ã‚Šä¸ŠãŒã‚ŠãŒã¿ã‚‰ã‚Œã‚‹ Dart ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚‚ã‚„ã£ã¦ã¿ã¾ã—ãŸï¼<br>ã“ã®æ™‚æ°—ã«ãªã‚‹ã®ãŒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã©ã†ã™ã‚‹ã‹å•é¡Œã§ã™ã­ï¼<br>ãƒ¡ã‚¸ãƒ£ãƒ¼ã©ã“ã‚ã¯ä¸‹è¨˜ã® 2 ã¤ã§ã™ï¼<br></p><p><a href=https://github.com/stablekernel/aqueduct>Aqueduct</a><br></p><p>æœ€çµ‚ commit 2020/09/01<br></p><p><a href=https://github.com/angel-dart/angel>Angel</a><br></p><p>æœ€çµ‚ commit 2020/05/05<br></p><p>ã¨ã“ã‚“ãªæ„Ÿã˜ã§é–‹ç™ºã¯ã©ã¡ã‚‰ã‚‚æ­¢ã¾ã£ã¦ãŠã‚Šï¼Œã‚‚ã¯ã‚„é¸æŠè‚¢ã«å…¥ã‚‰ãªã„çŠ¶æ…‹ã§ã™ï¼<br>ã¨ã„ã†ã‚ã‘ã§ shelf ã¨ shelf_router ã§å®Ÿè£…ã™ã‚‹ã®ãŒã‚ˆã•ãã†ãªé›°å›²æ°—ã§ã™ï¼<br></p><p><a href=https://pub.dev/packages/shelf>shelf</a><br></p><p><a href=https://pub.dev/packages/shelf_router>shelf_router</a><br></p><p>ã²ãªå½¢ãŒ stagehand ã§ä½œã‚Œã‚‹ã®ã§ãã¡ã‚‰ã§ï¼<br>ãŸã ã—ï¼Œshelf_router ã¯åˆæœŸã ã¨å«ã¾ã‚Œã¦ã„ãªã„ã®ã§ pubspec.yaml ã«è¿½åŠ ã—ã¦ãã ã•ã„ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ stagehand server-shelf
</span></span><span class=line><span class=cl>Creating server-shelf application <span class=sb>`</span>server_test<span class=sb>`</span>:
</span></span><span class=line><span class=cl>  /home/yuzumone/server_test/.gitignore
</span></span><span class=line><span class=cl>  /home/yuzumone/server_test/CHANGELOG.md
</span></span><span class=line><span class=cl>  /home/yuzumone/server_test/README.md
</span></span><span class=line><span class=cl>  /home/yuzumone/server_test/analysis_options.yaml
</span></span><span class=line><span class=cl>  /home/yuzumone/server_test/bin/server.dart
</span></span><span class=line><span class=cl>  /home/yuzumone/server_test/pubspec.yaml
</span></span><span class=line><span class=cl>  <span class=m>6</span> files written.
</span></span><span class=line><span class=cl>--&gt; to provision required packages, run <span class=s1>&#39;pub get&#39;</span>
</span></span><span class=line><span class=cl>--&gt; run your app via <span class=sb>`</span>dart bin/server.dart<span class=sb>`</span>.
</span></span></code></pre></div><p>åˆæœŸ server.dart ã¯ä¸‹è¨˜ã®é€šã‚Šï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=k>import</span> <span class=s1>&#39;dart:io&#39;</span><span class=p>;</span><span class=k>import</span> <span class=s1>&#39;package:args/args.dart&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=s1>&#39;package:shelf/shelf.dart&#39;</span> <span class=k>as</span> <span class=n>shelf</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=s1>&#39;package:shelf/shelf_io.dart&#39;</span> <span class=k>as</span> <span class=n>io</span><span class=p>;</span><span class=c1>// For Google Cloud Run, set _hostname to &#39;0.0.0.0&#39;.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>const</span> <span class=n>_hostname</span> <span class=o>=</span> <span class=s1>&#39;localhost&#39;</span><span class=p>;</span><span class=kt>void</span> <span class=n>main</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=kt>String</span><span class=o>&gt;</span> <span class=n>args</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=n>parser</span> <span class=o>=</span> <span class=n>ArgParser</span><span class=p>()..</span><span class=n>addOption</span><span class=p>(</span><span class=s1>&#39;port&#39;</span><span class=p>,</span> <span class=nl>abbr:</span> <span class=s1>&#39;p&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=n>result</span> <span class=o>=</span> <span class=n>parser</span><span class=p>.</span><span class=n>parse</span><span class=p>(</span><span class=n>args</span><span class=p>);</span><span class=c1>// For Google Cloud Run, we respect the PORT environment variable
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=n>portStr</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;port&#39;</span><span class=p>]</span> <span class=o>??</span> <span class=n>Platform</span><span class=p>.</span><span class=n>environment</span><span class=p>[</span><span class=s1>&#39;PORT&#39;</span><span class=p>]</span> <span class=o>??</span> <span class=s1>&#39;8080&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=n>port</span> <span class=o>=</span> <span class=kt>int</span><span class=p>.</span><span class=n>tryParse</span><span class=p>(</span><span class=n>portStr</span><span class=p>);</span><span class=k>if</span> <span class=p>(</span><span class=n>port</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>stdout</span><span class=p>.</span><span class=n>writeln</span><span class=p>(</span><span class=s1>&#39;Could not parse port value &#34;</span><span class=si>$</span><span class=n>portStr</span><span class=s1>&#34; into a number.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 64: command line usage error
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>exitCode</span> <span class=o>=</span> <span class=m>64</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span><span class=kd>var</span> <span class=n>handler</span> <span class=o>=</span> <span class=kd>const</span> <span class=n>shelf</span><span class=p>.</span><span class=n>Pipeline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=n>addMiddleware</span><span class=p>(</span><span class=n>shelf</span><span class=p>.</span><span class=n>logRequests</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>_echoRequest</span><span class=p>);</span><span class=kd>var</span> <span class=n>server</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>io</span><span class=p>.</span><span class=n>serve</span><span class=p>(</span><span class=n>handler</span><span class=p>,</span> <span class=n>_hostname</span><span class=p>,</span> <span class=n>port</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Serving at http://</span><span class=si>${</span><span class=n>server</span><span class=p>.</span><span class=n>address</span><span class=p>.</span><span class=n>host</span><span class=si>}</span><span class=s1>:</span><span class=si>${</span><span class=n>server</span><span class=p>.</span><span class=n>port</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>shelf</span><span class=p>.</span><span class=n>Response</span> <span class=n>_echoRequest</span><span class=p>(</span><span class=n>shelf</span><span class=p>.</span><span class=n>Request</span> <span class=n>request</span><span class=p>)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>shelf</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>ok</span><span class=p>(</span><span class=s1>&#39;Request for &#34;</span><span class=si>${</span><span class=n>request</span><span class=p>.</span><span class=n>url</span><span class=si>}</span><span class=s1>&#34;&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>ã“ã‚Œã‚’ shelf_router ã‚’ä½¿ã£ã¦ã„ã„æ„Ÿã˜ã« GET ã¨ POST ã‚’ç”Ÿã‚„ã—ã¦ã¿ã¾ã™ï¼<br>ä¸‹è¨˜ã®æ„Ÿã˜ã§ handler ã®ã¨ã“ã‚ã‚’æ›¸ãæ›ãˆã¾ã™ï¼<br>shelf_router ã‚’ä½¿ã†ã¨å¯¾å¿œ method ã¨ endpoint ãŒåˆ†ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ï¼<br>ã¡ãªã¿ã« shelf_router ã® README ã§ã¯ app.handler ã‚’æ¸¡ã™æ„Ÿã˜ã§è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ãŒï¼Œdeprecated ã«ãªã£ã¦ãŠã‚Šï¼Œä¸‹è¨˜ã®ã‚ˆã†ã« app è‡ªä½“ã‚’æ¸¡ã™ã®ãŒæ­£è§£ã§ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=kd>var</span> <span class=n>app</span> <span class=o>=</span> <span class=n>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=p>.</span><span class=kd>get</span><span class=p>(</span><span class=s1>&#39;/status&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>shelf</span><span class=p>.</span><span class=n>Request</span> <span class=n>request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>shelf</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>ok</span><span class=p>(</span><span class=s1>&#39;ok&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=p>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;/post&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>shelf</span><span class=p>.</span><span class=n>Request</span> <span class=n>request</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>content</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>request</span><span class=p>.</span><span class=n>readAsString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=p>.</span><span class=n>decode</span><span class=p>(</span><span class=n>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>shelf</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>ok</span><span class=p>(</span><span class=s1>&#39;Hello, </span><span class=si>${</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;text&#34;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>server</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>io</span><span class=p>.</span><span class=n>serve</span><span class=p>(</span><span class=n>app</span><span class=p>,</span> <span class=n>_hostname</span><span class=p>,</span> <span class=n>port</span><span class=p>);</span>
</span></span></code></pre></div><p>ã›ã£ã‹ãç”Ÿã‚„ã—ãŸã®ã§å©ã„ã¦ã¿ã¾ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl http://localhost:8080/status
</span></span><span class=line><span class=cl>ok
</span></span><span class=line><span class=cl>$ curl -X POST -d <span class=s1>&#39;{&#34;text&#34;: &#34;world&#34;}&#39;</span> http://localhost:8080/post
</span></span><span class=line><span class=cl>Hello, world
</span></span></code></pre></div><p>ã¡ãªã¿ã« shelf_router_generator ã¨ã„ã† package ã‚‚ã‚ã‚Šã“ã¡ã‚‰ã¯ Flask ã®ã‚ˆã†ã«ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã§ method ã‚„ endpoint ã‚’æŒ‡å®šã§ãã¾ã™ï¼<br>ã“ã£ã¡ã‚‚è‰¯ã•ãã†ã§ã™ï¼<br></p><p><a href=https://pub.dev/packages/shelf_router_generator>shelf_router_generator | Dart Package</a><br></p><p>ã‚ã¨ã“ã‚Œã¯å®Œå…¨ã«å‚™è€ƒã§ã™ãŒï¼Œshelf ã¯ã‚‚ã¡ã‚ã‚“ dart2native ã«å¯¾å¿œã—ã¦ã„ã¾ã™ï¼<br>Aqueduct ã¯å¯¾å¿œã—ã¦ã„ãªã‹ã£ãŸã®ã§ä¸€å¿œï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ dart2native bin/server.dart -o <span class=nb>test</span>
</span></span><span class=line><span class=cl>Generated: /home/yuzumone/server_test/test
</span></span></code></pre></div><h2 id=backlinks>Backlinks</h2><ul><li><a href=/posts/i-tried-dart-frontend-using-shelf/>I tried Dart frontend using shelf</a><br></li></ul></div></main><footer><section><p>Â© 2025 yuzumone's blog All rights reserved.</p></section></footer></article></body></html>