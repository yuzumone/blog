<!doctype html><html lang=ja-jp dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Unix domain socket on Dart | yuzumone's blog</title>
<meta name=description content="
    
  "><meta name=keywords content="
    
  "><style>@import 'https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP:wght@400;600&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Noto+Color+Emoji&family=Secular+One&display=swap'</style><link rel=stylesheet href=/css/main.min.c920c6820985c10fbbdc90a35fcfbbe126b074dade8529dee052ec789f76adaa.css integrity="sha256-ySDGggmFwQ+73JCjX8+74SawdNrehSne4FLseJ92rao=" crossorigin=anonymous><style>.bg{background-color:#f8f8f8}.chroma{background-color:#f8f8f8}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .cl{}.chroma .lnlinks{outline:none;text-decoration:none;color:inherit}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0}.chroma .hl{background-color:#dfdfdf}.chroma .lnt{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .line{display:flex}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:#ce5c00}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:#4e9a06}.chroma .sa{color:#4e9a06}.chroma .sb{color:#4e9a06}.chroma .sc{color:#4e9a06}.chroma .dl{color:#4e9a06}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:#4e9a06}.chroma .se{color:#4e9a06}.chroma .sh{color:#4e9a06}.chroma .si{color:#4e9a06}.chroma .sx{color:#4e9a06}.chroma .sr{color:#4e9a06}.chroma .s1{color:#4e9a06}.chroma .ss{color:#4e9a06}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:#ce5c00;font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:underline}</style><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js></script><script src=/js/search.942bd26f5f9a4a6909fc6fe8467bf5e63314ad56a308f6cf706af97ea3b80f27.js integrity="sha256-lCvSb1+aSmkJ/G/oRnv15jMUrVajCPbPcGr5fqO4Dyc=" crossorigin=anonymous></script></head><body><article class=posts><header><div class=header-container><div class=flex-none><h1 class=title><a href=https://blog.yuzumone.net/>yuzumone's blog</a></h1></div><nav><ul class=flex-items><li class=header-item><a href=/>Home</a></li><li class=header-item><a href=/archives/>Archives</a></li></ul></nav></div><div class=header-line></div></header><main><div><h1 class=article-title>Unix domain socket on Dart</h1><div class=header-container><time datetime=2022-07-30T00:00:00+00:00>üóì July 30, 2022</time><div class=article-tag><p class=flex-items>üè∑Ô∏è</p><ul class=flex-items><li class=header-item><a href=/tags/dart>Dart</a></li></ul></div></div></div><div><figure><img src="https://images.unsplash.com/photo-1534224039826-c7a0eda0e6b3?w=800&amp;auto=format&amp;fit=crop&amp;q=60&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwcm9maWxlLXBhZ2V8NjF8fHxlbnwwfHx8fHw%3D"><figcaption><h4>Photo by israel palacio on Unsplash</h4></figcaption></figure><p>Dart „Åß Unix domain socket „ÇÑ„Å£„Å¶„ÅÑ„Åç„Åæ„ÅôÔºé<br></p><p><a href=https://github.com/dart-lang/sdk/issues/42716>Support making HTTP requests through unix sockets</a><br></p><h2 id=Áí∞Â¢É>Áí∞Â¢É</h2><p>2.17.0‚Äì94.0.dev ‰ª•‰∏ä„Åß„ÅÇ„Çå„Å∞Âãï„Åè„ÅØ„ÅöÔºé<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ dart --version
</span></span><span class=line><span class=cl>Dart SDK version: 2.17.6 <span class=o>(</span>stable<span class=o>)</span> <span class=o>(</span>Tue Jul <span class=m>12</span> 12:54:37 <span class=m>2022</span> +0200<span class=o>)</span> on <span class=s2>&#34;linux_x64&#34;</span>
</span></span></code></pre></div><h2 id=get>Get</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=k>import</span> <span class=s1>&#39;dart:convert&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=s1>&#39;dart:io&#39;</span><span class=p>;</span><span class=kt>void</span> <span class=n>main</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=kt>String</span><span class=o>&gt;</span> <span class=n>arguments</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>HttpClient</span> <span class=n>client</span> <span class=o>=</span> <span class=n>HttpClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>..</span><span class=n>connectionFactory</span> <span class=o>=</span> <span class=p>(</span><span class=n>Uri</span> <span class=n>uri</span><span class=p>,</span> <span class=kt>String</span><span class=o>?</span> <span class=n>proxyHost</span><span class=p>,</span> <span class=kt>int</span><span class=o>?</span> <span class=n>proxyPort</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>assert</span><span class=p>(</span><span class=n>proxyHost</span> <span class=o>==</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>assert</span><span class=p>(</span><span class=n>proxyPort</span> <span class=o>==</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kd>var</span> <span class=n>address</span> <span class=o>=</span> <span class=n>InternetAddress</span><span class=p>(</span><span class=s2>&#34;/var/run/docker.sock&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nl>type:</span> <span class=n>InternetAddressType</span><span class=p>.</span><span class=n>unix</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>Socket</span><span class=p>.</span><span class=n>startConnect</span><span class=p>(</span><span class=n>address</span><span class=p>,</span> <span class=m>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>..</span><span class=n>findProxy</span> <span class=o>=</span> <span class=p>(</span><span class=n>Uri</span> <span class=n>uri</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=s1>&#39;DIRECT&#39;</span><span class=p>;</span><span class=kd>final</span> <span class=n>response</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=kd>await</span> <span class=n>client</span><span class=p>.</span><span class=n>getUrl</span><span class=p>(</span><span class=n>Uri</span><span class=p>.</span><span class=n>parse</span><span class=p>(</span><span class=s1>&#39;http://localhost/_ping&#39;</span><span class=p>)).</span><span class=n>then</span><span class=p>((</span><span class=n>request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>request</span><span class=p>.</span><span class=n>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=n>statusCode</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>responseText</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=n>transform</span><span class=p>(</span><span class=n>utf8</span><span class=p>.</span><span class=n>decoder</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=n>fold</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>(</span><span class=kt>String</span> <span class=n>x</span><span class=p>,</span> <span class=kt>String</span> <span class=n>y</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=n>responseText</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>client</span><span class=p>.</span><span class=n>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ÂÆüË°åÁµêÊûú<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ dart run bin/socket.dart
</span></span><span class=line><span class=cl><span class=m>200</span>
</span></span><span class=line><span class=cl>OK
</span></span></code></pre></div><p>curl „Å†„Å®„Åì„ÇåÁõ∏ÂΩì„Åß„Åô<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl --unix-socket /var/run/docker.sock http://localhost/_ping
</span></span><span class=line><span class=cl>OK
</span></span></code></pre></div><h2 id=post>Post</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=k>import</span> <span class=s1>&#39;dart:convert&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=s1>&#39;dart:io&#39;</span><span class=p>;</span><span class=kt>void</span> <span class=n>main</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=kt>String</span><span class=o>&gt;</span> <span class=n>arguments</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>HttpClient</span> <span class=n>client</span> <span class=o>=</span> <span class=n>HttpClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>..</span><span class=n>connectionFactory</span> <span class=o>=</span> <span class=p>(</span><span class=n>Uri</span> <span class=n>uri</span><span class=p>,</span> <span class=kt>String</span><span class=o>?</span> <span class=n>proxyHost</span><span class=p>,</span> <span class=kt>int</span><span class=o>?</span> <span class=n>proxyPort</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>assert</span><span class=p>(</span><span class=n>proxyHost</span> <span class=o>==</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>assert</span><span class=p>(</span><span class=n>proxyPort</span> <span class=o>==</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kd>var</span> <span class=n>address</span> <span class=o>=</span> <span class=n>InternetAddress</span><span class=p>(</span><span class=s2>&#34;/var/run/docker.sock&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nl>type:</span> <span class=n>InternetAddressType</span><span class=p>.</span><span class=n>unix</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>Socket</span><span class=p>.</span><span class=n>startConnect</span><span class=p>(</span><span class=n>address</span><span class=p>,</span> <span class=m>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>..</span><span class=n>findProxy</span> <span class=o>=</span> <span class=p>(</span><span class=n>Uri</span> <span class=n>uri</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=s1>&#39;DIRECT&#39;</span><span class=p>;</span><span class=kd>final</span> <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Image&#39;</span><span class=o>:</span> <span class=s1>&#39;hello-world&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>response</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=n>postUrl</span><span class=p>(</span><span class=n>Uri</span><span class=p>.</span><span class=n>parse</span><span class=p>(</span><span class=s1>&#39;http://localhost/containers/create&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=n>then</span><span class=p>((</span><span class=n>request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=p>.</span><span class=n>headers</span><span class=p>.</span><span class=n>contentType</span> <span class=o>=</span> <span class=n>ContentType</span><span class=p>(</span><span class=s1>&#39;application&#39;</span><span class=p>,</span> <span class=s1>&#39;json&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=n>json</span><span class=p>.</span><span class=n>encode</span><span class=p>(</span><span class=n>data</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>request</span><span class=p>.</span><span class=n>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=n>statusCode</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>res</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>postResponse</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=n>transform</span><span class=p>(</span><span class=n>utf8</span><span class=p>.</span><span class=n>decoder</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=n>fold</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>(</span><span class=kt>String</span> <span class=n>x</span><span class=p>,</span> <span class=kt>String</span> <span class=n>y</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=n>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>client</span><span class=p>.</span><span class=n>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ÂÆüË°åÁµêÊûú<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ dart run bin/socket.dart
</span></span><span class=line><span class=cl><span class=m>201</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;Id&#34;</span>:<span class=s2>&#34;636416b53763d106d54555d4709992000bc7709826daaa1f350295bb12d51d1b&#34;</span>,<span class=s2>&#34;Warnings&#34;</span>:<span class=o>[]}</span>
</span></span></code></pre></div><p>curl „Å†„Å®<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl --unix-socket /var/run/docker.sock http://localhost/containers/create
</span></span><span class=line><span class=cl> -X POST -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;Image&#34;: &#34;hello-world&#34;}&#39;</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;Id&#34;</span>:<span class=s2>&#34;ceb6473c162fbb5238703e07253ba5985938295b511453ca59e6b33a8cbbd224&#34;</span>,<span class=s2>&#34;Warnings&#34;</span>:<span class=o>[]}</span>
</span></span></code></pre></div></div></main><footer><section><p>¬© 2025 yuzumone's blog All rights reserved.</p></section></footer></article></body></html>