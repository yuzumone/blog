<!doctype html><html lang=ja-jp dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Flutter web oidc authentication | yuzumone's blog</title>
<meta name=description content="
    
  "><meta name=keywords content="
    
  "><style>@import 'https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP:wght@400;600&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Noto+Color+Emoji&family=Secular+One&display=swap'</style><link rel=stylesheet href=/css/main.min.c920c6820985c10fbbdc90a35fcfbbe126b074dade8529dee052ec789f76adaa.css integrity="sha256-ySDGggmFwQ+73JCjX8+74SawdNrehSne4FLseJ92rao=" crossorigin=anonymous><style>.bg{background-color:#f8f8f8}.chroma{background-color:#f8f8f8}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .cl{}.chroma .lnlinks{outline:none;text-decoration:none;color:inherit}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0}.chroma .hl{background-color:#dfdfdf}.chroma .lnt{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .line{display:flex}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:#ce5c00}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:#4e9a06}.chroma .sa{color:#4e9a06}.chroma .sb{color:#4e9a06}.chroma .sc{color:#4e9a06}.chroma .dl{color:#4e9a06}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:#4e9a06}.chroma .se{color:#4e9a06}.chroma .sh{color:#4e9a06}.chroma .si{color:#4e9a06}.chroma .sx{color:#4e9a06}.chroma .sr{color:#4e9a06}.chroma .s1{color:#4e9a06}.chroma .ss{color:#4e9a06}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:#ce5c00;font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:underline}</style><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js></script><script src=/js/search.942bd26f5f9a4a6909fc6fe8467bf5e63314ad56a308f6cf706af97ea3b80f27.js integrity="sha256-lCvSb1+aSmkJ/G/oRnv15jMUrVajCPbPcGr5fqO4Dyc=" crossorigin=anonymous></script></head><body><article class=posts><header><div class=header-container><div class=flex-none><h1 class=title><a href=https://blog.yuzumone.net/>yuzumone's blog</a></h1></div><nav><ul class=flex-items><li class=header-item><a href=/>Home</a></li><li class=header-item><a href=/archives/>Archives</a></li></ul></nav></div><div class=header-line></div></header><main><div><h1 class=article-title>Flutter web oidc authentication</h1><div class=header-container><time datetime=2020-11-23T00:00:00+00:00>ğŸ—“ November 23, 2020</time><div class=article-tag><p class=flex-items>ğŸ·ï¸</p><ul class=flex-items><li class=header-item><a href=/tags/flutter>Flutter</a></li></ul></div></div></div><div><figure><img src="https://images.unsplash.com/photo-1562770584-eaf50b017307?w=800&amp;auto=format&amp;fit=crop&amp;q=60&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8a2V5fGVufDB8fDB8fHwy"><figcaption><h4>Photo by Kelly Sikkema on Unsplash</h4></figcaption></figure><p>Flutter web ã§ OpenID Connect ã‚„ã£ã¦ãŸãƒ¡ãƒ¢ï¼<br>ä»¥ä¸‹ã‚’å‚è€ƒã«ã—ã¾ã—ãŸï¼<br></p><p><a href=https://pub.dev/packages/openid_client>openid_client | Dart Package</a><br></p><p>ã¾ãšã¯èªè¨¼ãƒšãƒ¼ã‚¸ã‚’å‡ºã™ã¨ã“ã‚ã¾ã§ï¼<br>Flutter web ã¯ SPA ãªã®ã§ Client Secret ã¯æ¸¡ã›ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ãŒæ¸¡ã—ã¾ã›ã‚“ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=kd>var</span> <span class=n>clientId</span> <span class=o>=</span> <span class=s1>&#39;foobar&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>uri</span> <span class=o>=</span> <span class=n>Uri</span><span class=p>.</span><span class=n>parse</span><span class=p>(</span><span class=s1>&#39;https://hogehoge.com&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>issuer</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>Issuer</span><span class=p>.</span><span class=n>discover</span><span class=p>(</span><span class=n>uri</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>client</span> <span class=o>=</span> <span class=n>Client</span><span class=p>(</span><span class=n>issuer</span><span class=p>,</span> <span class=n>clientId</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>authenticator</span> <span class=o>=</span> <span class=n>Authenticator</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=nl>scopes:</span> <span class=n>scopes</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>authenticator</span><span class=p>.</span><span class=n>authorize</span><span class=p>();</span>
</span></span></code></pre></div><p>authorize ã®ä¸­èº«ï¼<br>state ã‚’ LocalStorage ã«å…¥ã‚Œã¦ï¼Œèªè¨¼ãƒšãƒ¼ã‚¸ã‚’ href ã«å…¥ã‚Œã¦ã„ã‚‹ã ã‘ã§ã™ã­ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=kt>void</span> <span class=n>authorize</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>_forgetCredentials</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>window</span><span class=p>.</span><span class=n>localStorage</span><span class=p>[</span><span class=s1>&#39;openid_client:state&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>flow</span><span class=p>.</span><span class=n>state</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>window</span><span class=p>.</span><span class=n>location</span><span class=p>.</span><span class=n>href</span> <span class=o>=</span> <span class=n>flow</span><span class=p>.</span><span class=n>authenticationUri</span><span class=p>.</span><span class=n>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ã•ã‚ã“ã“ã‹ã‚‰ã‚µãƒ³ãƒ—ãƒ«ã¨é•ã†ã¨ã“ã‚ã§ã™ï¼<br>ã‚µãƒ³ãƒ—ãƒ«ã®å ´åˆã¯ãã‚‚ãã‚‚ Flutter web ã§ã¯ãªã„ã®ã§ 1 æšã® View ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼<br>ã—ã‹ã— Flutter ã®å ´åˆã¯é•ã„ã¾ã™ï¼<br>å¤šãã®å ´åˆä»¥ä¸‹ã®ã‚ˆã†ãª MainApp ã‚’ç”¨æ„ã—ã¦ home ãªã‚Š routes ã§å­ View ãŒã„ã¦ãã®å­ View ã«èªè¨¼ãƒœã‚¿ãƒ³ã®ã‚ˆã†ãªã‚‚ã®ã‚’ç”¨æ„ã™ã‚‹ã®ãŒå¤šã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=kd>class</span> <span class=nc>MyApp</span> <span class=kd>extends</span> <span class=n>StatelessWidget</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>@</span><span class=n>override</span>
</span></span><span class=line><span class=cl>  <span class=n>Widget</span> <span class=n>build</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>MaterialApp</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ã“ã®å ´åˆï¼Œèªè¨¼ãŒå®Œäº†ã—ã¦ query parameter ã§æ¸¡ã•ã‚ŒãŸå€¤ã¯å½“ãŸã‚Šå‰ã§ã™ãŒå­ View ã«ä¼æ¬ã•ã‚Œã¾ã›ã‚“ï¼<br>ã¨ã„ã†ã“ã¨ã§ MyApp ã® build ã§ openid_client ã§ã‚„ã£ã¦ã„ã‚‹å®Ÿè£…ã‚’ã‚„ã£ã¦ã¿ã¾ã—ãŸï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=err>@</span><span class=n>override</span>
</span></span><span class=line><span class=cl><span class=n>Widget</span> <span class=n>build</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>checkExp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>location</span><span class=p>.</span><span class=n>href</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=n>uri</span> <span class=o>=</span> <span class=n>Uri</span><span class=p>(</span><span class=nl>query:</span> <span class=n>Uri</span><span class=p>.</span><span class=n>parse</span><span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>location</span><span class=p>.</span><span class=n>href</span><span class=p>).</span><span class=n>fragment</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=n>q</span> <span class=o>=</span> <span class=n>uri</span><span class=p>.</span><span class=n>queryParameters</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>q</span><span class=p>.</span><span class=n>containsKey</span><span class=p>(</span><span class=s1>&#39;access_token&#39;</span><span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span><span class=p>.</span><span class=n>containsKey</span><span class=p>(</span><span class=s1>&#39;code&#39;</span><span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span><span class=p>.</span><span class=n>containsKey</span><span class=p>(</span><span class=s1>&#39;id_token&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>localStorage</span><span class=p>[</span><span class=s1>&#39;openid_client:state&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>q</span><span class=p>[</span><span class=s1>&#39;state&#39;</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>window</span><span class=p>.</span><span class=n>localStorage</span><span class=p>[</span><span class=s1>&#39;openid_client:auth&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=p>.</span><span class=n>encode</span><span class=p>(</span><span class=n>q</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>checkExp() ã¯æœŸé™ã®ç¢ºèªã‚’ã—ã¦ã„ã¾ã™ï¼<br>ä¸­èº«ã¯ã“ã‚“ãªï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=kt>void</span> <span class=n>checkExp</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>([</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=kc>null</span><span class=p>].</span><span class=n>contains</span><span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>localStorage</span><span class=p>[</span><span class=s1>&#39;openid_client:auth&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=n>auth</span> <span class=o>=</span> <span class=n>json</span><span class=p>.</span><span class=n>decode</span><span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>localStorage</span><span class=p>[</span><span class=s1>&#39;openid_client:auth&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=n>token</span> <span class=o>=</span> <span class=n>auth</span><span class=p>[</span><span class=s1>&#39;id_token&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=n>jwt</span> <span class=o>=</span> <span class=n>json</span><span class=p>.</span><span class=n>decode</span><span class=p>(</span><span class=n>utf8</span><span class=p>.</span><span class=n>decode</span><span class=p>(</span><span class=n>base64Url</span><span class=p>.</span><span class=n>decode</span><span class=p>(</span><span class=n>token</span><span class=p>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=m>1</span><span class=p>])));</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=n>exp</span> <span class=o>=</span> <span class=n>jwt</span><span class=p>[</span><span class=s1>&#39;exp&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=n>now</span> <span class=o>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>now</span><span class=p>().</span><span class=n>millisecondsSinceEpoch</span> <span class=o>~/</span> <span class=m>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>exp</span> <span class=o>&lt;</span> <span class=n>now</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>window</span><span class=p>.</span><span class=n>localStorage</span><span class=p>[</span><span class=s1>&#39;openid_client:auth&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ã‚ã¨ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ¡ä»¶ã§ãƒ­ã‚°ã‚¤ãƒ³å¾Œã® View ã‚’å‡ºã—åˆ†ã‘ã™ã‚‹æ„Ÿã˜ã§ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=kc>null</span><span class=p>].</span><span class=n>contains</span><span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>localStorage</span><span class=p>[</span><span class=s1>&#39;ipenid_client:auth&#39;</span><span class=p>])</span>
</span></span></code></pre></div><p>å¤šåˆ† runApp() ã®ã¨ã“ã‚ã‚‰ã¸ã‚“ã§ Authenticator ã‚’æŒã£ã¦ï½ï½ã£ã¦ã‚„ã‚Œã°ã‚µãƒ³ãƒ—ãƒ«é€šã‚Šã«ã‹ã‘ã‚‹ã‚“ã ã‘ã©ã“ã‚Œã§å‹•ãã‹ã‚‰ã„ã„ã‹ãªã¨ï¼<br></p><p>ã‚ã¨ openid ã¯é–¢ä¿‚ãªã„ã‚“ã ã‘ã©ï¼ŒlocalStrage å‚ç…§ã—ã¦ã„ã‚‹ã®ã‚‚ã‚ã£ã¦ãƒ†ã‚¹ãƒˆã¯ platform æŒ‡å®šã—ãªã„ã¨å‹•ã‹ãªã‹ã£ãŸã®ã§ãƒ¡ãƒ¢ï¼<br></p><pre tabindex=0><code class=language-dash data-lang=dash>$ flutter test --platform chrome -v
</code></pre></div></main><footer><section><p>Â© 2025 yuzumone's blog All rights reserved.</p></section></footer></article></body></html>