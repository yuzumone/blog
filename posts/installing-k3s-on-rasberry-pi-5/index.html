<!doctype html><html lang=ja-jp dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Installing k3s on rasberry pi 5 | yuzumone's blog</title>
<meta name=description content="
    
  "><meta name=keywords content="
    
  "><meta name=Hatena::Bookmark content="nocomment"><style>@import 'https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP:wght@400;600&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Noto+Color+Emoji&family=Secular+One&display=swap'</style><link rel=stylesheet href=/css/main.min.2421e6cca60bf0bd0ce22a86e5391b0a7b5bbd939bf4e3d651fd3384307eba3b.css integrity="sha256-JCHmzKYL8L0M4iqG5TkbCntbvZOb9OPWUf0zhDB+ujs=" crossorigin=anonymous><style>.bg{background-color:#f8f8f8}.chroma{background-color:#f8f8f8}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .cl{}.chroma .lnlinks{outline:none;text-decoration:none;color:inherit}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0}.chroma .hl{background-color:#dfdfdf}.chroma .lnt{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .line{display:flex}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:#ce5c00}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:#4e9a06}.chroma .sa{color:#4e9a06}.chroma .sb{color:#4e9a06}.chroma .sc{color:#4e9a06}.chroma .dl{color:#4e9a06}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:#4e9a06}.chroma .se{color:#4e9a06}.chroma .sh{color:#4e9a06}.chroma .si{color:#4e9a06}.chroma .sx{color:#4e9a06}.chroma .sr{color:#4e9a06}.chroma .s1{color:#4e9a06}.chroma .ss{color:#4e9a06}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:#ce5c00;font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:underline}</style><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js></script><script src=/js/search.942bd26f5f9a4a6909fc6fe8467bf5e63314ad56a308f6cf706af97ea3b80f27.js integrity="sha256-lCvSb1+aSmkJ/G/oRnv15jMUrVajCPbPcGr5fqO4Dyc=" crossorigin=anonymous></script></head><body><article class=posts><header><div class=header-container><div class=flex-none><h1 class=title><a href=https://blog.yuzumone.net/>yuzumone's blog</a></h1></div><nav><ul class=flex-items><li class=header-item><a href=/>Home</a></li><li class=header-item><a href=/archives/>Archives</a></li></ul></nav></div><div class=header-line></div></header><main><div><h1 class=article-title>Installing k3s on rasberry pi 5</h1><div class=header-container><time datetime=2025-03-05T00:00:00+00:00>ğŸ—“ March 5, 2025</time><div class=article-tag><p class=flex-items>ğŸ·ï¸</p><ul class=flex-items><li class=header-item><a href=/tags/kubernetes>Kubernetes</a></li></ul></div></div><details class=page-toc><summary>Table of Contents</summary><nav id=TableOfContents><ul><li><a href=#raspberry-pi-imager>Raspberry Pi Imager</a></li><li><a href=#static-ip>Static IP</a></li><li><a href=#storage>Storage</a></li><li><a href=#swap-off>swap off</a></li><li><a href=#enable-cgroups>Enable cgroups</a></li><li><a href=#install-k3s>Install k3s</a></li><li><a href=#install-longhorn>Install Longhorn</a></li></ul></nav></details></div><div><figure><img src="https://images.unsplash.com/photo-1631553127988-36343ac5bb0c?q=80&amp;w=2670&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"><figcaption><h4>Photo by Jainath Ponnala on Unsplash</h4></figcaption></figure><h2 id=raspberry-pi-imager>Raspberry Pi Imager</h2><p>ssh ã¨ã‹æ˜”ã¯ mkdir ã¨ã‹ã‚„ã£ãŸè¨˜æ†¶ãªã‚“ã§ã™ãŒï¼Œä»Šã¯ Imager ã®è¨­å®šã§ ssh ã‚„éµèªè¨¼ã¾ã§è¨­å®šã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸï¼<br></p><h2 id=static-ip>Static IP</h2><p>ç¾åœ¨ã¯ NetworkManager ã§è¨­å®šã™ã‚‹ã®ãŒãƒŠã‚¦ã„ã‚ˆã†ã§ã™ï¼<br>åˆæœŸã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„ã®ã§åå‰ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã¾ãšã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yuzumone@raspberrypi:~ $ nmcli connection show
</span></span><span class=line><span class=cl>NAME                UUID                                  TYPE      DEVICE
</span></span><span class=line><span class=cl>Wired Connection <span class=m>1</span>  9f707e45-298e-39b3-80ef-5bbd96c03f46  ethernet  eth0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ nmcli connection modify 9f707e45-298e-39b3-80ef-5bbd96c03f46 connection.id wired_eth0
</span></span></code></pre></div><p>/etc/NetworkManager/system-connections é…ä¸‹ã« åå‰.nmconnection ã§ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼<br>ã‚ã¨ã¯ <code>[ipv4]</code> ã®ã¨ã“ã‚ã«è¨­å®šã—ã¾ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yuzumone@raspberrypi:~ $ sudo cat /etc/NetworkManager/system-connections/wired_eth0.nmconnection
</span></span><span class=line><span class=cl><span class=o>[</span>connection<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>id</span><span class=o>=</span>wired_eth0
</span></span><span class=line><span class=cl><span class=nv>uuid</span><span class=o>=</span>9f707e45-298e-39b3-80ef-5bbd96c03f46
</span></span><span class=line><span class=cl><span class=nv>type</span><span class=o>=</span>ethernet
</span></span><span class=line><span class=cl>autoconnect-priority<span class=o>=</span>-999
</span></span><span class=line><span class=cl>interface-name<span class=o>=</span>eth0
</span></span><span class=line><span class=cl><span class=nv>timestamp</span><span class=o>=</span><span class=m>1741091271</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>ethernet<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>ipv4<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>method</span><span class=o>=</span>manual
</span></span><span class=line><span class=cl><span class=nv>addresses</span><span class=o>=</span>192.168.0.100/24
</span></span><span class=line><span class=cl><span class=nv>gateway</span><span class=o>=</span>192.168.0.1
</span></span><span class=line><span class=cl><span class=nv>dns</span><span class=o>=</span>8.8.8.8<span class=p>;</span>8.8.4.4<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>ipv6<span class=o>]</span>
</span></span><span class=line><span class=cl>addr-gen-mode<span class=o>=</span>default
</span></span><span class=line><span class=cl><span class=nv>method</span><span class=o>=</span>auto
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>proxy<span class=o>]</span>
</span></span></code></pre></div><p>è¨­å®šã—ãŸã‚ã¨ã¯ <code>sudo systemctl restart NetworkManager</code> ã‚’ã—ã¦é©å¿œã—ã¾ã™ï¼<br></p><h2 id=storage>Storage</h2><p>Longhorn ã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ /var/lib/longhorn ã« mount ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yuzumone@raspberrypi:~ $ sudo mkfs -t ext4 /dev/sda
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ sudo mkdir /var/lib/longhorn
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ sudo chmod <span class=m>777</span> /var/lib/longhorn
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ sudo mount -t ext4 /dev/sda /var/lib/longhorn
</span></span></code></pre></div><p>blkid ã§ UUID ã‚’ç¢ºèªã—ã¦ /etc/fstab ã«è¿½è¨˜ã—ã¦ãŠãã¾ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yuzumone@raspberrypi:~ $ blkid
</span></span><span class=line><span class=cl>/dev/sda: <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;919fb770-af9c-487f-a758-6190b524497c&#34;</span> <span class=nv>BLOCK_SIZE</span><span class=o>=</span><span class=s2>&#34;4096&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;ext4&#34;</span>
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ cat /etc/fstab
</span></span><span class=line><span class=cl>proc            /proc           proc    defaults          <span class=m>0</span>       <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nv>PARTUUID</span><span class=o>=</span>b5d3bfc3-01  /boot/firmware  vfat    defaults          <span class=m>0</span>       <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=nv>PARTUUID</span><span class=o>=</span>b5d3bfc3-02  /               ext4    defaults,noatime  <span class=m>0</span>       <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=c1># a swapfile is not a swap partition, no line here</span>
</span></span><span class=line><span class=cl><span class=c1>#   use  dphys-swapfile swap[on|off]  for that</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;919fb770-af9c-487f-a758-6190b524497c&#34;</span> /var/lib/longhorn ext4 defaults <span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></div><h2 id=swap-off>swap off</h2><p>swap ã®åˆ©ç”¨ã¯éæ¨å¥¨ãªã®ã§ off ã—ã¾ã™ï¼<br><code>cat /proc/swaps</code> ã§ç¢ºèªãŒã§ãã¾ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yuzumone@raspberrypi:~ $ sudo swapoff --all
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ sudo systemctl stop dphys-swapfile
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ sudo systemctl disable dphys-swapfile
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ sudo systemctl status dphys-swapfile
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ cat /proc/swaps
</span></span><span class=line><span class=cl>Filename                                Type            Size            Used            Priority
</span></span></code></pre></div><h2 id=enable-cgroups>Enable cgroups</h2><p>cgroup_memory=1 cgroup_enable=memory ã‚’ /boot/firmware/cmdline.txt ã«è¿½è¨˜ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yuzumone@raspberrypi:~ $ cat /boot/firmware/cmdline.txt
</span></span><span class=line><span class=cl><span class=nv>console</span><span class=o>=</span>serial0,115200 <span class=nv>console</span><span class=o>=</span>tty1 <span class=nv>root</span><span class=o>=</span><span class=nv>PARTUUID</span><span class=o>=</span>b5d3bfc3-02 <span class=nv>rootfstype</span><span class=o>=</span>ext4 fsck.repair<span class=o>=</span>yes rootwait <span class=nv>cgroup_memory</span><span class=o>=</span><span class=m>1</span> <span class=nv>cgroup_enable</span><span class=o>=</span>memory
</span></span></code></pre></div><h2 id=install-k3s>Install k3s</h2><p>ã‚¯ãƒ©ã‚¹ã‚¿ã¯çµ„ã¾ãªã„ã®ã§ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã®ã‚„ã¤ã§é©å½“ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼<br>ã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ã‚€å ´åˆã¯ ansible role ã‚’åˆ©ç”¨ã™ã‚‹ã®ãŒè‰¯ã•ãã†ã§ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yuzumone@raspberrypi:~ $ curl -sfL https://get.k3s.io <span class=p>|</span> sh -s - --write-kubeconfig-mode <span class=m>644</span>
</span></span><span class=line><span class=cl>yuzumone@raspberrypi:~ $ kubectl get nodes
</span></span><span class=line><span class=cl>NAME          STATUS   ROLES                  AGE   VERSION
</span></span><span class=line><span class=cl>raspberrypi   Ready    control-plane,master   17s   v1.31.6+k3s1
</span></span></code></pre></div><h2 id=install-longhorn>Install Longhorn</h2><p>å®Ÿéš›ã«ç«‹ã¦ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯ cloudflare-tunnel-ingress-controller ã‚’åˆ©ç”¨ã—ã‚ˆã†ã¨æ€ã†ã®ã§ï¼Œå†…ã€…ã§è¦‹ã‚Œã‚Œã°è‰¯ã„ã‚‚ã®ã¯ NodePort ã§é©å½“ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ï¼<br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt -y install open-iscsi
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add longhorn https://charts.longhorn.io
</span></span><span class=line><span class=cl>helm repo update
</span></span><span class=line><span class=cl>helm install longhorn longhorn/longhorn --namespace longhorn-system --create-namespace -f values.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl -n longhorn-system get po1
</span></span><span class=line><span class=cl>NAME                                        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>engine-image-ei-c2d50bcc-mnnll              1/1     Running   <span class=m>0</span>          10s
</span></span><span class=line><span class=cl>longhorn-driver-deployer-7fc7ffcb7f-mqkdg   1/1     Running   <span class=m>0</span>          20s
</span></span><span class=line><span class=cl>longhorn-manager-l5ggl                      2/2     Running   <span class=m>0</span>          20s
</span></span><span class=line><span class=cl>longhorn-ui-5fcc4bcfc7-dpgcw                1/1     Running   <span class=m>0</span>          20s
</span></span><span class=line><span class=cl>longhorn-ui-5fcc4bcfc7-ll6wm                1/1     Running   <span class=m>0</span>          20s
</span></span></code></pre></div></div></main><footer><section><p>Â© 2025 yuzumone's blog All rights reserved.</p></section></footer></article></body></html>